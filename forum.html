<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EDUMATCH Forum</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/css/main.css" rel="stylesheet">
  <style>
    .post-container {
      background-color: #f9f9f9;
      /* A lighter background */
      border: 1px solid #ddd;
      border-radius: 8px;
      /* Slightly more rounded corners */
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      /* A subtle shadow */
      width: 50rem;
      /* Make it responsive */
    }

    .post-title {
      font-size: 22px;
      /* Slightly larger title */
      font-weight: 600;
      /* Semi-bold */
      color: #333;
      /* Darker text color */
      margin-bottom: 10px;
    }

    .post-content {
      font-size: 16px;
      line-height: 1.7;
      /* Improved readability */
      color: #555;
      /* Slightly lighter text color */
    }

    .post-actions {
      margin-top: 10px;
    }

    .post-actions button {
      background-color: #CE1212;
      /* Consistent primary color */
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      /* Consistent rounded corners */
      cursor: pointer;
      margin-right: 10px;
      transition: background-color 0.3s ease;
      /* Smooth transition */
    }

    .post-actions button:hover {
      background-color: #9e0e0e;
      /* Darker shade on hover */
    }

    .sidebar {
      background-color: #f8f9fa;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-right: 20px;
      width: 16rem;
    }

    .sidebar h3 {
      font-size: 18px;
      margin-bottom: 15px;
    }

    .sidebar input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .sidebar select {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .sidebar button {
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .sidebar button:hover {
      background-color: #0056b3;
    }

    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }

    .page-button {
      background-color: #f8f9fa;
      border: 1px solid #ddd;
      color: #333;
      padding: 8px 12px;
      margin: 0 5px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
    }

    .page-button:hover {
      background-color: #007bff;
      color: #fff;
      border-color: #007bff;
    }

    .page-button.active {
      background-color: #007bff;
      color: #fff;
      border-color: #007bff;
    }
  </style>
</head>

<body class="index-page">
  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container position-relative d-flex align-items-center justify-content-between">

      <a href="index.html" class="logo d-flex align-items-center me-auto me-xl-0">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <img src="assets/img/EDUMATCH.jpg" alt="">
        <h1 class="sitename">EDUMATCH</h1>
        <span>.</span>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="index.html" class="active">Home<br></a></li>
          <li><a href="forum.html">Diễn đàn</a></li>
          <li><a href="findTeacher-page.html">Tìm Gia Sư</a></li>
          <li><a href="payment.html">Payment</a></li>
          <li><a href="student-schedule.html">Thời khóa biểu</a></li>

          <li><a href="#contact">Liên hệ</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

      <a id="authButton" class="btn-getstarted" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">Đăng
        nhập</a>
      <div id="userDropdown" class="d-none dropdown">
        <button class="btn btn-secondary dropdown-toggle username-text" type="button" id="userDropdownButton"
          data-bs-toggle="dropdown" aria-expanded="false">
          Tài khoản
        </button>
        <ul class="dropdown-menu" aria-labelledby="userDropdownButton">
          <li><a class="dropdown-item" href="profile.html" id="profileLink">Thông tin tài khoản</a></li>

          <li><a class="dropdown-item" href="index.html" id="logoutButton">Đăng xuất</a></li>
        </ul>
      </div>

    </div>
  </header>
  <div class="container mt-5 d-flex">
    <div class="sidebar">
      <a class="btn btn-danger" id="addPostButton"
        style="margin-bottom: 2rem; width: 100%; padding: 10px; border: none; border-radius: 5px; cursor: pointer;">
        Thêm bài viết mới</a>
      <h3>Bộ lọc bài viết</h3>
      <input type="text" placeholder="Tìm kiếm..." id="search-input">
      <select id="subject-select">
        <option value="">Chọn môn học</option>
      </select>
      <button id="search-button">Tìm kiếm</button>
    </div>
    <div class="content" id="post-container">
      <!-- Posts will be dynamically inserted here -->
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination" id="pagination-container">
    <!-- Pagination buttons will be dynamically inserted here -->
  </div>

  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/js/main.js"></script>
  <script type="module">
    import Post from './Post.js';

    document.addEventListener('DOMContentLoaded', function () {
      const postContainer = document.getElementById('post-container');
      const searchInput = document.getElementById('search-input');
      const searchButton = document.getElementById('search-button');
      const subjectSelect = document.getElementById('subject-select');
      const paginationContainer = document.getElementById('pagination-container');

      let currentPage = 0;
      const pageSize = 5;
      let currentUrl = 'http://157.66.24.154:8080/Post/getAllPost1';

      function fetchPaginatedPosts(url, pageNo = 0, pageSize = 5) {
        console.log("Fetching paginated posts from URL:", url); // Debugging URL
        fetch(`${url}?pageNo=${pageNo}&pageSize=${pageSize}`)
          .then(response => response.json())
          .then(data => {
            console.log("API Response:", data);
            postContainer.innerHTML = '';

            if (data.result && data.result.content && Array.isArray(data.result.content) && data.result.content.length > 0) {
              data.result.content.forEach(postData => {
                const post = new Post(
                  postData.id,
                  postData.userID,
                  postData.username,
                  postData.subjectID,
                  postData.subjectname,
                  postData.title,
                  postData.content,
                  postData.rating,
                  postData.createdAt,
                  postData.updatedAt
                );
                const postElement = createPostElement(post);
                postContainer.appendChild(postElement);
              });
              updatePagination(data.result.totalPages, pageNo);
            } else {
              postContainer.innerHTML = '<p>Không có kết quả nào được hiển thị</p>';
              console.error("Data.result is not an array or is empty:", data.result);
            }
          })
          .catch(error => console.error('Error fetching posts:', error));
      }

      function fetchAllPosts(url) {
        console.log("Fetching all posts from URL:", url);
        fetch(url)
          .then(response => response.json())
          .then(data => {
            console.log("API Response:", data);
            postContainer.innerHTML = '';

            if (data.result && Array.isArray(data.result)) {
              data.result.forEach(postData => {
                const post = new Post(
                  postData.id,
                  postData.userID,
                  postData.username,
                  postData.subjectID,
                  postData.subjectname,
                  postData.title,
                  postData.content,
                  postData.rating,
                  postData.createdAt,
                  postData.updatedAt
                );
                const postElement = createPostElement(post);
                postContainer.appendChild(postElement);
              });
              paginationContainer.innerHTML = ''; // Remove pagination
            } else {
              postContainer.innerHTML = '<p>Không có kết quả nào được hiển thị</p>';
              console.error("Data.result is not an array or is empty:", data.result);
            }
          })
          .catch(error => console.error('Error fetching posts:', error));
      }

      function createPostElement(post) {
        const postElement = document.createElement('div');
        postElement.classList.add('post-container');
        postElement.innerHTML = `
                  <div class="post-user">Người tạo bài viết: ${post.username}</div>
                  <div class="post-subject">Môn học: ${post.subjectname}</div>
                  <div class="post-title">Tiêu đề bài viết: ${post.title}</div>
                  <div class="post-content">${post.content}</div>
                  <div class="post-rating">Số sao đánh giá: ${post.rating}</div>
                  <div class="post-created-at">Ngày tạo bài viết: ${post.createdAt}</div>
                  <div class="post-updated-at">Ngày cập nhật bài viết: ${post.updatedAt}</div>
                  <div class="post-actions">
                      <button><i class="fas fa-thumbs-up"></i> Like</button>
                      <button><i class="fas fa-comment"></i> Comment</button>
                  </div>
              `;
        return postElement;
      }

      function fetchSubjects() {
        fetch('http://157.66.24.154:8080/Post/getAllSubject')
          .then(response => response.json())
          .then(data => {
            console.log("Subjects API Response:", data);
            if (data.result && Array.isArray(data.result)) {
              data.result.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject;
                subjectSelect.appendChild(option);
              });
            } else {
              postContainer.innerHTML = '<p>Không có kết quả nào được hiển thị</p>';
              console.error("Data.result is not an array:", data.result);
            }
          })
          .catch(error => console.error('Error fetching subjects:', error));
      }

      function updatePagination(totalPages, currentPage) {
        paginationContainer.innerHTML = '';
        for (let i = 0; i < totalPages; i++) {
          const pageButton = document.createElement('button');
          pageButton.textContent = i + 1;
          pageButton.classList.add('page-button');
          if (i === currentPage) {
            pageButton.classList.add('active');
          }
          pageButton.addEventListener('click', () => {
            currentPage = i;
            fetchPaginatedPosts(currentUrl, currentPage, pageSize);
          });
          paginationContainer.appendChild(pageButton);
        }
      }

      // Fetch all posts on page load
      fetchPaginatedPosts(currentUrl, currentPage, pageSize);
      // Fetch all subjects on page load
      fetchSubjects();

      // Search event listener
      searchButton.addEventListener('click', function () {
        const username = searchInput.value;
        const subjectname = subjectSelect.value;
        let url = 'http://157.66.24.154:8080/Post/getAllPost'; // Default to getAllPost for search

        if (username && subjectname) {
          url = `http://157.66.24.154:8080/Post/findPostsBySubjectAndUsername?subjectname=${subjectname}&username=${username}`;
        } else if (username) {
          url = `http://157.66.24.154:8080/Post/findPostsByUsername?username=${username}`;
        } else if (subjectname) {
          url = `http://157.66.24.154:8080/Post/findPostsBySubject?subjectname=${subjectname}`;
        }

        currentUrl = url;
        fetchAllPosts(currentUrl);
      });
    });
  </script>
  <!-- Modal for adding post -->
  <div class="modal fade" id="addPostModal" tabindex="-1" aria-labelledby="addPostModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content shadow-lg border-0 rounded-4">
        <div class="modal-header border-0 bg-danger text-white text-center">
          <h2 class="modal-title w-100 fw-bold display-5" id="addPostModalLabel">Thêm bài viết mới</h2>
          <button type="button" class="btn-close btn-close-white position-absolute end-0 me-3" data-bs-dismiss="modal"
            aria-label="Close"></button>
        </div>
        <div class="modal-body p-5">
          <form id="addPostForm">
            <div class="mb-3">
              <label for="postTitle" class="form-label fw-semibold">Tiêu đề</label>
              <input type="text" class="form-control rounded-3 p-2" id="postTitle" placeholder="Nhập tiêu đề" required>
            </div>
            <div class="mb-3">
              <label for="postContent" class="form-label fw-semibold">Nội dung</label>
              <textarea class="form-control rounded-3 p-2" id="postContent" rows="5" placeholder="Nhập nội dung"
                required></textarea>
            </div>
            <div class="mb-3">
              <label for="modal-subject-select" class="form-label fw-semibold">Chọn môn học</label>
              <select class="form-control rounded-3 p-2" id="modal-subject-select" required>
                <option value="">Chọn môn học</option>
              </select>
            </div>
            <button type="submit" class="btn w-100 py-2 rounded-3 text-white" style="background-color: #CE1212;">Đăng
              bài viết</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <!-- Login/Register Modal -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
      <div class="modal-content shadow-lg border-0 rounded-4">
        <div class="modal-header border-0 bg-danger text-white text-center">
          <h2 class="modal-title w-100 fw-bold display-5" id="loginModalLabel">🎉 Chào mừng bạn! 🎉</h2>
          <button type="button" class="btn-close btn-close-white position-absolute end-0 me-3" data-bs-dismiss="modal"
            aria-label="Close"></button>
        </div>
        <div class="modal-body p-5">
          <!-- Tabs for Login & Register -->
          <ul class="nav nav-pills nav-justified mb-3" id="loginRegisterTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active fw-bold" id="login-tab" data-bs-toggle="tab" data-bs-target="#login"
                type="button" role="tab">Đăng nhập</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link fw-bold" id="register-tab" data-bs-toggle="tab" data-bs-target="#register"
                type="button" role="tab">Đăng ký</button>
            </li>
          </ul>

          <div class="tab-content mt-3">
            <!-- Login Form -->
            <div class="tab-pane fade show active" id="login" role="tabpanel">
              <form id="loginForm" class="d-flex flex-column align-items-center">
                <div class="mb-3 w-50 text-start">
                  <label for="loginUsername" class="form-label fw-semibold">Username</label>
                  <input type="text" class="form-control rounded-3 p-2" id="loginUsername" name="username"
                    placeholder="Nhập username" required>
                </div>
                <div class="mb-3 w-50 text-start">
                  <label for="loginPassword" class="form-label fw-semibold">Mật khẩu</label>
                  <input type="password" class="form-control rounded-3 p-2" id="loginPassword" name="password"
                    placeholder="Nhập mật khẩu" required>
                </div>
                <button type="submit" class="btn text-white rounded-3 mt-2 px-4 py-2"
                  style="background-color: #CE1212;">Đăng nhập</button>
                <p class="mt-2">
                  <a href="#" id="forgotPasswordLink" class="text-decoration-none">Quên mật khẩu?</a>
                </p>
              </form>


            </div>

            <!-- Modal Quên Mật Khẩu -->
            <div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">Quên Mật Khẩu</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                  </div>
                  <div class="modal-body">
                    <input type="email" id="forgotEmail" class="form-control mb-2" placeholder="Nhập email">
                    <button id="sendOtpBtn" class="btn btn-primary w-100">Gửi OTP</button>

                    <div id="otpSection" style="display:none;">
                      <input type="text" id="otpCode" class="form-control mt-3" placeholder="Nhập mã OTP">
                      <input type="password" id="newPassword" class="form-control mt-2" placeholder="Nhập mật khẩu mới">
                      <button id="resetPasswordBtn" class="btn btn-success w-100 mt-2">Đặt lại mật khẩu</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Register Form -->
            <div class="tab-pane fade" id="register" role="tabpanel">
              <form id="registerForm">
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="registerName" class="form-label fw-semibold">Họ và Tên</label>
                      <input type="text" class="form-control rounded-3 p-2" id="registerName" placeholder="Nhập họ tên"
                        required>
                    </div>
                    <div class="mb-3">
                      <label for="registerPhone" class="form-label fw-semibold">Số điện thoại</label>
                      <input type="tel" class="form-control rounded-3 p-2" id="registerPhone"
                        placeholder="Nhập số điện thoại" required>
                    </div>
                    <div class="mb-3">
                      <label for="registerEmail" class="form-label fw-semibold">Email</label>
                      <input type="email" class="form-control rounded-3 p-2" id="registerEmail" placeholder="Nhập email"
                        required>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="registerPassword" class="form-label fw-semibold">Mật khẩu</label>
                      <input type="password" class="form-control rounded-3 p-2" id="registerPassword"
                        placeholder="Tạo mật khẩu" required>
                    </div>
                    <div class="mb-3">
                      <label for="username" class="form-label fw-semibold">Username</label>
                      <input type="text" class="form-control rounded-3 p-2" id="username" placeholder="Nhập username"
                        required>
                    </div>
                    <div class="mb-3">
                      <label for="registerRole" class="form-label fw-semibold">Chọn vai trò</label>
                      <select class="form-control rounded-3 p-2" id="registerRole" required>
                        <option value="" selected></option>
                        <option value="Student">Student</option>
                        <option value="Tutor">Tutor</option>
                      </select>
                    </div>


                    <!-- Trường dành cho Tutor -->
                    <div id="tutorFields" style="display: none;">
                      <div class="mb-3">
                        <label for="gender" class="form-label fw-semibold">Giới tính</label>
                        <select class="form-control rounded-3 p-2" id="gender">
                          <option value="0">Nam</option>
                          <option value="1">Nữ</option>
                        </select>
                      </div>
                      <div class="mb-3">
                        <label for="dateOfBirth" class="form-label fw-semibold">Ngày sinh</label>
                        <input type="date" class="form-control rounded-3 p-2" id="dateOfBirth">
                      </div>
                      <div class="mb-3">
                        <label for="address" class="form-label fw-semibold">Địa chỉ</label>
                        <input type="text" class="form-control rounded-3 p-2" id="address" placeholder="Nhập địa chỉ">
                      </div>
                      <div class="mb-3">
                        <label for="qualification" class="form-label fw-semibold">Bằng cấp</label>
                        <input type="text" class="form-control rounded-3 p-2" id="qualification"
                          placeholder="Nhập bằng cấp">
                      </div>
                      <div class="mb-3">
                        <label for="experience" class="form-label fw-semibold">Kinh nghiệm (năm)</label>
                        <input type="number" class="form-control rounded-3 p-2" id="experience" min="0"
                          placeholder="Nhập số năm kinh nghiệm">
                      </div>
                      <div class="mb-3">
                        <label for="bio" class="form-label fw-semibold">Giới thiệu</label>
                        <textarea class="form-control rounded-3 p-2" id="bio"
                          placeholder="Giới thiệu bản thân"></textarea>
                      </div>
                    </div>

                    <!-- Trường dành cho Student -->
                    <div id="studentFields" style="display: none;">
                      <div class="mb-3">
                        <label for="parentName" class="form-label fw-semibold">Tên phụ huynh</label>
                        <input type="text" class="form-control rounded-3 p-2" id="parentName"
                          placeholder="Nhập tên phụ huynh">
                      </div>
                      <div class="mb-3">
                        <label for="grade" class="form-label fw-semibold">Lớp học</label>
                        <input type="text" class="form-control rounded-3 p-2" id="grade" placeholder="Nhập lớp học">
                      </div>
                      <div class="mb-3">
                        <label for="addressStudent" class="form-label fw-semibold">Địa chỉ</label>
                        <input type="text" class="form-control rounded-3 p-2" id="addressStudent"
                          placeholder="Nhập địa chỉ">
                      </div>
                      <div class="mb-3">
                        <label for="notes" class="form-label fw-semibold">Ghi chú</label>
                        <textarea class="form-control rounded-3 p-2" id="notes"
                          placeholder="Nhập ghi chú (nếu có)"></textarea>
                      </div>
                    </div>

                  </div>
                </div>

                <button type="submit" class="btn w-100 py-2 rounded-3 text-white"
                  style="background-color: #CE1212;">Đăng ký</button>
              </form>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const registerForm = document.querySelector("#registerForm");
        const loginRegisterTabs = new bootstrap.Tab(document.querySelector("#login-tab"));
  
        registerForm.addEventListener("submit", async function (event) {
          event.preventDefault();
  
          // Lấy dữ liệu từ form
          const fullname = document.getElementById("registerName").value;
          const phoneNumber = document.getElementById("registerPhone").value;
          const email = document.getElementById("registerEmail").value;
          const password = document.getElementById("registerPassword").value;
          const username = document.getElementById("username").value;
          const role = document.getElementById("registerRole").value;
  
          // Kiểm tra mật khẩu có khớp không
          if (password.length < 6) {
            Swal.fire({
              title: "Lỗi!",
              text: "Mật khẩu phải có ít nhất 6 ký tự!",
              icon: "error",
              confirmButtonText: "Thử lại"
            });
            return;
          }
  
          // Tạo đối tượng dữ liệu gửi đi
          let requestBody = {
            username: username,
            fullname: fullname,
            phoneNumber: phoneNumber,
            email: email,
            password: password,
            role: role
          };
  
          // Nếu role là Tutor, thêm thông tin Tutor
          if (role === "Tutor") {
            requestBody.gender = document.getElementById("gender").value === "1";
            requestBody.dateOfBirth = document.getElementById("dateOfBirth").value;
            requestBody.address = document.getElementById("address").value;
            requestBody.qualification = document.getElementById("qualification").value;
            requestBody.experience = document.getElementById("experience").value;
            requestBody.bio = document.getElementById("bio").value;
          }
  
          // Nếu role là Student, thêm thông tin Student
          if (role === "Student") {
            requestBody.parentName = document.getElementById("parentName").value;
            requestBody.grade = document.getElementById("grade").value;
            requestBody.address = document.getElementById("addressStudent").value;
            requestBody.notes = document.getElementById("notes").value;
          }
  
          // Kiểm tra log dữ liệu gửi đi
          console.log("Dữ liệu gửi lên:", JSON.stringify(requestBody, null, 2));
  
          // Gửi request đến backend
          const response = await fetch("http://157.66.24.154:8080/users/register", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(requestBody),
          });
  
          const result = await response.text();
          if (response.ok) {
            Swal.fire({
              title: "Đăng ký thành công!",
              text: "Bây giờ bạn có thể đăng nhập.",
              icon: "success",
              confirmButtonText: "Đăng nhập ngay"
            }).then(() => {
              registerForm.reset();
              loginRegisterTabs.show();
            });
          } else {
            Swal.fire({
              title: "Lỗi!",
              text: result,
              icon: "error",
              confirmButtonText: "Thử lại"
            });
          }
        });
      });
  
  
    </script>
    <script>
    document.addEventListener("DOMContentLoaded", function () {
      const forgotPasswordLink = document.getElementById("forgotPasswordLink");
      const forgotPasswordModal = new bootstrap.Modal(document.getElementById("forgotPasswordModal"));

      forgotPasswordLink.addEventListener("click", function (event) {
        event.preventDefault(); // Ngăn chặn chuyển hướng trang
        forgotPasswordModal.show(); // Mở modal quên mật khẩu
      });
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const authButton = document.getElementById("authButton");
      const userDropdown = document.getElementById("userDropdown");
      const userDropdownButton = document.getElementById("userDropdownButton");
      const logoutButton = document.getElementById("logoutButton");
      const loginModal = new bootstrap.Modal(document.getElementById("loginModal"));

      // Kiểm tra session trong localStorage
      const user = localStorage.getItem("user");
      if (user) {
        const userData = JSON.parse(user);
        authButton.classList.add("d-none");
        userDropdownButton.textContent = userData.username;
        userDropdown.classList.remove("d-none");
      }

      // Xử lý đăng nhập
      document.getElementById("loginForm").addEventListener("submit", async function (event) {
        event.preventDefault();
        const username = document.getElementById("loginUsername").value;
        const password = document.getElementById("loginPassword").value;

        const response = await fetch("http://localhost:8080/users/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password })
        });

        if (response.ok) {
          const data = await response.json();
          localStorage.setItem("user", JSON.stringify({ username: data.username, userId: data.userID }));
          localStorage.setItem("userID", data.userID);
          localStorage.setItem("role", data.role);// Lưu session vào localStorage
          localStorage.setItem("fullname", data.fullname);
          localStorage.setItem("email", data.email);
          localStorage.setItem("phoneNumber", data.phoneNumber);
          authButton.classList.add("d-none");
          userDropdownButton.textContent = data.username;
          userDropdown.classList.remove("d-none");
          loginModal.hide();

          // Hiển thị thông báo đăng nhập thành công
          Swal.fire({
            title: "Thành công!",
            text: "Đăng nhập thành công!",
            icon: "success",
            confirmButtonText: "OK"
          }).then(() => {
            location.reload();
          });
        } else {
          Swal.fire({
            title: "Lỗi!",
            text: "Đăng nhập thất bại. Vui lòng kiểm tra lại!",
            icon: "error",
            confirmButtonText: "Thử lại"
          });
        }
      });

      // Xử lý đăng xuất
      logoutButton.addEventListener("click", function () {
        localStorage.removeItem("user"); // Xóa session khỏi localStorage
        localStorage.clear();

        userDropdown.classList.add("d-none");
        authButton.classList.remove("d-none");

        Swal.fire({
          title: "Đã đăng xuất!",
          text: "Bạn đã đăng xuất thành công.",
          icon: "success",
          confirmButtonText: "OK"
        });
      });

      // Kiểm tra session từ server nếu cần
      async function checkSession() {
        const response = await fetch("http://localhost:8080/users/profile", { credentials: "include" });
        if (response.ok) {
          const data = await response.json();
          localStorage.setItem("user", JSON.stringify({ username: data.username }));
          localStorage.setItem("userID", userData.id);// Đảm bảo lưu vào localStorage

          authButton.classList.add("d-none");
          userDropdownButton.textContent = data.username;
          userDropdown.classList.remove("d-none");
        }
      }

      checkSession(); // Kiểm tra session khi tải trang
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const addPostButton = document.getElementById("addPostButton");
      const addPostModal = new bootstrap.Modal(document.getElementById('addPostModal'));
      const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));

      addPostButton.addEventListener("click", function (event) {
        const user = JSON.parse(localStorage.getItem("user"));
        if (!user) {
          event.preventDefault();
          Swal.fire({
            icon: 'warning',
            title: 'Bạn cần đăng nhập để thêm bài viết.',
            showConfirmButton: true
          });
          loginModal.show();
          return;
        }
        addPostModal.show();
      });

      const addPostForm = document.querySelector("#addPostForm");

      addPostForm.addEventListener("submit", async function (event) {
        event.preventDefault();

        // Lấy dữ liệu từ form
        const title = document.getElementById("postTitle").value;
        const content = document.getElementById("postContent").value;
        const subjectID = document.getElementById("modal-subject-select").value;
        const user = JSON.parse(localStorage.getItem("user"));
        if (!user) {
          Swal.fire({
            icon: 'warning',
            title: 'Bạn cần đăng nhập để thêm bài viết.',
            showConfirmButton: true
          });
          loginModal.show();
          return;
        }

        const userID = user.userId;

        // Gửi request đến backend
        const response = await fetch("http://157.66.24.154:8080/Post/addPost", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            UserID: userID,
            SubjectID: subjectID,
            Title: title,
            Content: content,
            Rating: 5
          }),
        });

        const result = await response.json();
        if (response.ok) {
          Swal.fire({
            icon: 'success',
            title: 'Bài viết đã được thêm thành công!',
            showConfirmButton: false,
            timer: 1500
          }).then(() => {
            addPostForm.reset();
            addPostModal.hide();
            location.reload();
          });
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Lỗi',
            text: result.message,
            showConfirmButton: true
          });
          console.error("Error details:", result);
        }
      });

      // Fetch subjects and populate the subject select dropdown
      fetch('http://157.66.24.154:8080/Post/getAllSubject2')
        .then(response => response.json())
        .then(data => {
          const subjectSelect = document.getElementById("modal-subject-select");
          if (data.result && Array.isArray(data.result)) {
            data.result.forEach(subject => {
              const option = document.createElement('option');
              option.value = subject.id; // Sử dụng SubjectID làm giá trị
              option.textContent = subject.subjectname; // Hiển thị SubjectName
              console.log("Subject Option: ", option); // Debugging option
              subjectSelect.appendChild(option);
            });
          } else {
            console.error("Data.result is not an array:", data.result);
          }
        })
        .catch(error => console.error('Error fetching subjects:', error));
    });
  </script>

  <footer id="footer" class="footer dark-background">
    <div class="container">
      <div class="row gy-3">
        <div class="col-lg-3 col-md-6 d-flex">
          <i class="bi bi-geo-alt icon"></i>
          <div class="address">
            <h4>Address</h4>
            <p>A108 Adam Street</p>
            <p>New York, NY 535022</p>
            <p></p>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 d-flex">
          <i class="bi bi-telephone icon"></i>
          <div>
            <h4>Contact</h4>
            <p>
              <strong>Phone:</strong> <span>+1 5589 55488 55</span><br>
              <strong>Email:</strong> <span>info@example.com</span><br>
            </p>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 d-flex">
          <i class="bi bi-clock icon"></i>
          <div>
            <h4>Opening Hours</h4>
            <p>
              <strong>Mon-Sat:</strong> <span>11AM - 23PM</span><br>
              <strong>Sunday</strong>: <span>Closed</span>
            </p>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <h4>Follow Us</h4>
          <div class="social-links d-flex">
            <a href="#" class="twitter"><i class="bi bi-twitter-x"></i></a>
            <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
            <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
            <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a>
          </div>
        </div>
      </div>
    </div>
    <div class="container copyright text-center mt-4">
      <p>© <span>Copyright</span> <strong class="px-1 sitename">Yummy</strong> <span>All Rights Reserved</span>
      </p>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you've purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: [buy-url] -->
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a> Distributed by <a
          href="https://themewagon.com">ThemeWagon</a>
      </div>
    </div>
  </footer>
  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>
  <!-- Preloader -->
  <div id="preloader"></div>
  <!-- Vendor JS Files -->
  <script src="assets/js/auth.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js">
  </script>

</html>